(globalThis["webpackChunkblackowl"]=globalThis["webpackChunkblackowl"]||[]).push([[493],{7003:(e,t,a)=>{"use strict";a.d(t,{L:()=>o,y:()=>i});var r=a(7816),l=a(1764);const o=async(e,t)=>{const a=await(0,r.x9)(l.j,e,t);return a.user},i=async()=>{await(0,r.CI)(l.j)}},2493:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>tt});var r=a(1347),l=a(7763),o=a(8633),i=a(1930),s=a.n(i);const n={class:"tw-px-3 tw-pt-6 tw-flex tw-items-center tw-justify-between"},d={class:"tw-flex tw-items-center tw-space-x-3"},u={class:"tw-flex tw-flex-col tw-p-3 tw-space-y-3"},c={class:"tw-flex tw-flex-col"},m={class:"tw-flex tw-flex-col"},b={class:"tw-flex tw-flex-col"},p={class:"tw-flex tw-items-center tw-justify-end"},f={class:"tw-px-3 tw-mt-3"},g=["onClick"],k={class:"tw-flex tw-items-center tw-justify-between tw-mb-3"},w={class:"tw-font-bold tw-text-lg"},y={class:"tw-text-xs"},_={class:"tw-mb-3"},v={class:"tw-font-bold tw-text-lg"},j={class:"tw-capitalize"},F={class:"tw-text-xs"},M={class:"tw-mb-3"},x={class:"tw-bg-slate-500 tw-text-white tw-text-right -tw-mx-3 tw-px-2"},L={class:"tw-flex tw-items-center tw-justify-center"},D={key:0},h={class:"tw-text-lg"},C={class:"tw-text-lg"},A={class:"tw-bg-slate-500 tw-text-white tw-px-2 tw-flex tw-items-center tw-justify-between"};function N(e,t,a,i,N,S){const V=(0,r.g2)("q-btn"),q=(0,r.g2)("q-checkbox"),I=(0,r.g2)("q-menu"),T=(0,r.g2)("q-icon"),E=(0,r.g2)("q-input"),Q=(0,r.g2)("q-item-section"),z=(0,r.g2)("q-item"),O=(0,r.g2)("q-list"),U=(0,r.g2)("q-spinner-dots"),W=(0,r.g2)("q-infinite-scroll"),J=(0,r.g2)("q-page-sticky"),P=(0,r.g2)("q-card-section"),Y=(0,r.g2)("add-job-form"),K=(0,r.g2)("q-card"),R=(0,r.g2)("q-dialog"),X=(0,r.g2)("update-job-form"),H=(0,r.g2)("job-history"),$=(0,r.g2)("job-detail"),B=(0,r.g2)("job-notes"),G=(0,r.g2)("form-comment"),Z=(0,r.g2)("q-card-actions"),ee=(0,r.g2)("q-page"),te=(0,r.gN)("close-popup"),ae=(0,r.gN)("ripple");return(0,r.uX)(),(0,r.Wv)(ee,{class:"tw-container tw-mx-auto tw-relative tw-pb-16"},{default:(0,r.k6)((()=>[(0,r.Lk)("div",n,[(0,r.Lk)("div",d,[(0,r.bF)(V,{color:"primary",flat:"",round:"",icon:"mdi-close",size:"sm","no-caps":"",onClick:e.close},null,8,["onClick"]),t[19]||(t[19]=(0,r.Lk)("img",{class:"tw-w-6",src:s(),alt:"Blackowl"},null,-1)),t[20]||(t[20]=(0,r.Lk)("h3",{class:"tw-text-lg tw-font-extrabold tw-text-white"},"Blackowl",-1))]),(0,r.bF)(V,{color:"primary",icon:"mdi-filter-cog",flat:"",round:""},{default:(0,r.k6)((()=>[(0,r.bF)(I,{dark:""},{default:(0,r.k6)((()=>[(0,r.Lk)("div",u,[t[22]||(t[22]=(0,r.Lk)("div",{class:"tw-text-lg tw-mb-3"},"Filtros",-1)),(0,r.Lk)("div",c,[(0,r.bF)(q,{dark:"",modelValue:e.requiresAttentionFilter,"onUpdate:modelValue":t[0]||(t[0]=t=>e.requiresAttentionFilter=t),"toggle-indeterminate":"",label:"Requiere Atención",color:"primary"},null,8,["modelValue"])]),(0,r.Lk)("div",m,[(0,r.bF)(q,{dark:"",modelValue:e.paidFilter,"onUpdate:modelValue":t[1]||(t[1]=t=>e.paidFilter=t),"toggle-indeterminate":"",label:"Pagado",color:"primary"},null,8,["modelValue"])]),(0,r.Lk)("div",b,[t[21]||(t[21]=(0,r.Lk)("div",null,"Estado",-1)),(0,r.bF)(q,{dark:"",modelValue:e.statusFilter,"onUpdate:modelValue":t[2]||(t[2]=t=>e.statusFilter=t),val:"pending",label:"Pendiente/Nuevo",color:"primary"},null,8,["modelValue"]),(0,r.bF)(q,{dark:"",modelValue:e.statusFilter,"onUpdate:modelValue":t[3]||(t[3]=t=>e.statusFilter=t),val:"process",label:"En Proceso",color:"primary"},null,8,["modelValue"]),(0,r.bF)(q,{dark:"",modelValue:e.statusFilter,"onUpdate:modelValue":t[4]||(t[4]=t=>e.statusFilter=t),val:"canceled",label:"Cancelado",color:"primary"},null,8,["modelValue"]),(0,r.bF)(q,{dark:"",modelValue:e.statusFilter,"onUpdate:modelValue":t[5]||(t[5]=t=>e.statusFilter=t),val:"damaged",label:"Con Daño",color:"primary"},null,8,["modelValue"]),(0,r.bF)(q,{dark:"",modelValue:e.statusFilter,"onUpdate:modelValue":t[6]||(t[6]=t=>e.statusFilter=t),val:"finished",label:"Terminado",color:"primary"},null,8,["modelValue"]),(0,r.bF)(q,{dark:"",modelValue:e.statusFilter,"onUpdate:modelValue":t[7]||(t[7]=t=>e.statusFilter=t),val:"delivered",label:"Entregado/Instalado",color:"primary"},null,8,["modelValue"]),(0,r.bF)(q,{dark:"",modelValue:e.statusFilter,"onUpdate:modelValue":t[8]||(t[8]=t=>e.statusFilter=t),val:"returned",label:"Devuelto",color:"primary"},null,8,["modelValue"])]),(0,r.Lk)("div",p,[(0,r.bo)((0,r.bF)(V,{color:"primary",label:"Aplicar",onClick:e.restart,"no-caps":"",flat:""},null,8,["onClick"]),[[te]])])])])),_:1})])),_:1})]),(0,r.Lk)("div",f,[(0,r.bF)(E,{modelValue:e.reference,"onUpdate:modelValue":[t[9]||(t[9]=t=>e.reference=t),e.restart],type:"text",label:"Referencia",debounce:"500",filled:"",dark:"",clearable:""},{append:(0,r.k6)((()=>[(0,r.bF)(T,{name:"mdi-magnify"})])),_:1},8,["modelValue","onUpdate:modelValue"])]),(0,r.bF)(W,{ref:"infinite",onLoad:e.loadJobs,offset:250,class:"tw-space-y-3 tw-p-3 tw-w-full"},{loading:(0,r.k6)((()=>[(0,r.Lk)("div",L,[(0,r.bF)(U,{color:"primary",size:"40px"})])])),default:(0,r.k6)((()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.jobs,((a,i)=>(0,r.bo)(((0,r.uX)(),(0,r.CE)("div",{key:i,class:"tw-bg-slate-950 tw-rounded-xl tw-px-3 tw-pt-3 tw-overflow-hidden tw-w-full tw-shadow tw-relative",onClick:t=>e.showJob(i,a)},[(0,r.Lk)("div",k,[(0,r.Lk)("div",null,[(0,r.Lk)("div",w,"Referencia: "+(0,l.v_)(a.reference),1),(0,r.Lk)("div",y,"creado: "+(0,l.v_)(e.formatDateDateTimeString(a.created_at.toDate())),1)]),a.requires_attention?((0,r.uX)(),(0,r.Wv)(T,{key:0,name:"mdi-pin",color:"white",size:"20px"})):(0,r.Q3)("",!0),a.paid?((0,r.uX)(),(0,r.Wv)(T,{key:1,name:"mdi-cash",color:"white",size:"20px"})):(0,r.Q3)("",!0),(0,r.bF)(V,{color:"primary",icon:"mdi-dots-vertical",flat:"",round:"",onClick:(0,o.D$)((e=>null),["stop"])},{default:(0,r.k6)((()=>[(0,r.bF)(I,{dark:"","auto-close":""},{default:(0,r.k6)((()=>[(0,r.bF)(O,{separator:"",dark:""},{default:(0,r.k6)((()=>[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(z,{clickable:"",onClick:t=>e.showHistory(i,a)},{default:(0,r.k6)((()=>[(0,r.bF)(Q,{avatar:""},{default:(0,r.k6)((()=>[(0,r.bF)(T,{color:"primary",name:"mdi-history"})])),_:1}),(0,r.bF)(Q,null,{default:(0,r.k6)((()=>t[23]||(t[23]=[(0,r.eW)("Ver Historial")]))),_:1})])),_:2},1032,["onClick"])),[[ae]]),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(z,{clickable:"",onClick:t=>e.deleteJobConfirm(i,a)},{default:(0,r.k6)((()=>[(0,r.bF)(Q,{avatar:""},{default:(0,r.k6)((()=>[(0,r.bF)(T,{color:"red",name:"mdi-delete"})])),_:1}),(0,r.bF)(Q,null,{default:(0,r.k6)((()=>t[24]||(t[24]=[(0,r.eW)("Eliminar")]))),_:1})])),_:2},1032,["onClick"])),[[ae]]),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(z,{clickable:"",onClick:t=>e.updateJob(i,a)},{default:(0,r.k6)((()=>[(0,r.bF)(Q,{avatar:""},{default:(0,r.k6)((()=>[(0,r.bF)(T,{color:"primary",name:"mdi-pencil"})])),_:1}),(0,r.bF)(Q,null,{default:(0,r.k6)((()=>t[25]||(t[25]=[(0,r.eW)("Editar")]))),_:1})])),_:2},1032,["onClick"])),[[ae]]),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(z,{clickable:"",onClick:t=>e.requiresAttention(i,a)},{default:(0,r.k6)((()=>[a.requires_attention?((0,r.uX)(),(0,r.CE)(r.FK,{key:1},[(0,r.bF)(Q,{avatar:""},{default:(0,r.k6)((()=>[(0,r.bF)(T,{color:"primary",name:"mdi-pin-off"})])),_:1}),(0,r.bF)(Q,null,{default:(0,r.k6)((()=>t[27]||(t[27]=[(0,r.eW)("No Requiere Atención")]))),_:1})],64)):((0,r.uX)(),(0,r.CE)(r.FK,{key:0},[(0,r.bF)(Q,{avatar:""},{default:(0,r.k6)((()=>[(0,r.bF)(T,{color:"primary",name:"mdi-pin"})])),_:1}),(0,r.bF)(Q,null,{default:(0,r.k6)((()=>t[26]||(t[26]=[(0,r.eW)("Requiere Atención")]))),_:1})],64))])),_:2},1032,["onClick"])),[[ae]]),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(z,{clickable:"",onClick:t=>e.paid(i,a)},{default:(0,r.k6)((()=>[a.paid?((0,r.uX)(),(0,r.CE)(r.FK,{key:1},[(0,r.bF)(Q,{avatar:""},{default:(0,r.k6)((()=>[(0,r.bF)(T,{color:"primary",name:"mdi-currency-usd-off"})])),_:1}),(0,r.bF)(Q,null,{default:(0,r.k6)((()=>t[29]||(t[29]=[(0,r.eW)("Sin Pago")]))),_:1})],64)):((0,r.uX)(),(0,r.CE)(r.FK,{key:0},[(0,r.bF)(Q,{avatar:""},{default:(0,r.k6)((()=>[(0,r.bF)(T,{color:"primary",name:"mdi-currency-usd"})])),_:1}),(0,r.bF)(Q,null,{default:(0,r.k6)((()=>t[28]||(t[28]=[(0,r.eW)("Pagado")]))),_:1})],64))])),_:2},1032,["onClick"])),[[ae]])])),_:2},1024)])),_:2},1024)])),_:2},1024)]),(0,r.Lk)("div",_,[(0,r.Lk)("div",v,[t[30]||(t[30]=(0,r.eW)(" Cliente: ")),(0,r.Lk)("span",j,(0,l.v_)(a.client),1)]),(0,r.Lk)("div",F,"telefono: "+(0,l.v_)(a.phone),1)]),(0,r.Lk)("div",M,(0,l.v_)(a.description),1),(0,r.Lk)("div",x,"Estado: "+(0,l.v_)(e.statuses[a.status]),1),(0,r.Lk)("div",{style:(0,l.Tr)({backgroundColor:e.getColorBasedOnDate(a.agreed_delivery_date.toDate())}),class:"-tw-mx-3 tw-text-black tw-font-bold tw-px-3 tw-text-right"}," Fecha de entrega: "+(0,l.v_)(e.formatDateDateString(a.agreed_delivery_date.toDate())),5)],8,g)),[[ae]]))),128)),e.loading||e.jobs.length?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("div",D,"No se encontraron trabajos...."))])),_:1},8,["onLoad"]),(0,r.bF)(J,{position:"bottom-right",offset:[18,18]},{default:(0,r.k6)((()=>[(0,r.bF)(V,{fab:"",icon:"mdi-plus",color:"primary",onClick:t[10]||(t[10]=t=>e.create=!0)})])),_:1}),(0,r.bF)(R,{modelValue:e.create,"onUpdate:modelValue":t[11]||(t[11]=t=>e.create=t),persistent:"","full-width":""},{default:(0,r.k6)((()=>[(0,r.bF)(K,{class:"tw-bg-slate-900 tw-text-gray-400 tw-flex tw-flex-col"},{default:(0,r.k6)((()=>[(0,r.bF)(P,{class:"tw-flex tw-items-center tw-justify-between"},{default:(0,r.k6)((()=>[t[31]||(t[31]=(0,r.Lk)("div",{class:"tw-text-lg"},"Nuevo Trabajo",-1)),(0,r.bo)((0,r.bF)(V,{icon:"mdi-close",round:"",flat:""},null,512),[[te]])])),_:1}),(0,r.bF)(P,{class:"tw-pt-0 scroll"},{default:(0,r.k6)((()=>[(0,r.bF)(Y,{onSuccess:e.onCreated},null,8,["onSuccess"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,r.bF)(R,{modelValue:e.update,"onUpdate:modelValue":t[12]||(t[12]=t=>e.update=t),persistent:"","full-width":""},{default:(0,r.k6)((()=>[(0,r.bF)(K,{class:"tw-bg-slate-900 tw-text-gray-400 tw-flex tw-flex-col"},{default:(0,r.k6)((()=>[(0,r.bF)(P,{class:"tw-flex tw-items-center tw-justify-between"},{default:(0,r.k6)((()=>[t[32]||(t[32]=(0,r.Lk)("div",{class:"tw-text-lg"},"Editar Trabajo",-1)),(0,r.bo)((0,r.bF)(V,{icon:"mdi-close",round:"",flat:""},null,512),[[te]])])),_:1}),(0,r.bF)(P,{class:"tw-pt-0 scroll"},{default:(0,r.k6)((()=>[(0,r.bF)(X,{job:e.selectedJob.job,onSuccess:e.onUpdated},null,8,["job","onSuccess"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,r.bF)(R,{modelValue:e.history,"onUpdate:modelValue":t[13]||(t[13]=t=>e.history=t),persistent:"",maximized:""},{default:(0,r.k6)((()=>[(0,r.bF)(K,{class:"tw-bg-slate-900 tw-text-gray-400 tw-flex tw-flex-col"},{default:(0,r.k6)((()=>[(0,r.bF)(P,{class:"tw-flex tw-items-center tw-justify-between"},{default:(0,r.k6)((()=>[(0,r.Lk)("div",h,"Historial de "+(0,l.v_)(e.selectedJob.job.reference),1),(0,r.bo)((0,r.bF)(V,{icon:"mdi-close",round:"",flat:""},null,512),[[te]])])),_:1}),(0,r.bF)(P,{class:"tw-pt-0 scroll"},{default:(0,r.k6)((()=>[(0,r.bF)(H,{job:e.selectedJob.job},null,8,["job"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,r.bF)(R,{modelValue:e.show,"onUpdate:modelValue":t[18]||(t[18]=t=>e.show=t),persistent:"",maximized:""},{default:(0,r.k6)((()=>[(0,r.bF)(K,{class:"tw-bg-slate-900 tw-text-gray-400 tw-flex tw-flex-col"},{default:(0,r.k6)((()=>[(0,r.bF)(P,{class:"tw-flex tw-items-center tw-justify-between"},{default:(0,r.k6)((()=>[(0,r.Lk)("div",C,"Ref. "+(0,l.v_)(e.selectedJob.job.reference),1),(0,r.Lk)("div",null,[(0,r.bF)(V,{icon:e.selectedJob.job.requires_attention?"mdi-pin":"mdi-pin-off",round:"",flat:"",onClick:t[14]||(t[14]=t=>e.requiresAttention(e.selectedJob.index,e.selectedJob.job))},null,8,["icon"]),(0,r.bF)(V,{icon:e.selectedJob.job.paid?"mdi-currency-usd":"mdi-currency-usd-off",round:"",flat:"",onClick:t[15]||(t[15]=t=>e.paid(e.selectedJob.index,e.selectedJob.job))},null,8,["icon"]),(0,r.bF)(V,{icon:"mdi-history",round:"",flat:"",onClick:t[16]||(t[16]=t=>e.showHistory(e.selectedJob.index,e.selectedJob.job))}),(0,r.bo)((0,r.bF)(V,{icon:"mdi-close",round:"",flat:""},null,512),[[te]])])])),_:1}),(0,r.Lk)("div",A,[(0,r.Lk)("div",null,"Estado: "+(0,l.v_)(e.statuses[e.selectedJob.job.status]),1),(0,r.bF)(V,{color:"white",icon:"mdi-swap-horizontal",label:"Cambiar",flat:"","no-caps":"",onClick:t[17]||(t[17]=t=>e.changeStatus(e.selectedJob.index,e.selectedJob.job))})]),(0,r.Lk)("div",{style:(0,l.Tr)({backgroundColor:e.getColorBasedOnDate(e.selectedJob.job.agreed_delivery_date.toDate())}),class:"tw-text-black tw-font-bold tw-px-3"}," Fecha de entrega: "+(0,l.v_)(e.formatDateDateString(e.selectedJob.job.agreed_delivery_date.toDate())),5),(0,r.bF)(P,{class:"tw-pt-0 tw-flex-grow scroll"},{default:(0,r.k6)((()=>[(0,r.bF)($,{job:e.selectedJob.job},null,8,["job"]),(0,r.bF)(B,{job:e.selectedJob.job},null,8,["job"])])),_:1}),(0,r.bF)(Z,null,{default:(0,r.k6)((()=>[(0,r.bF)(G,{job:e.selectedJob.job,class:"tw-w-full"},null,8,["job"])])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})}var S=a(4187);const V={class:"tw-flex tw-items-center tw-justify-center"},q={class:"tw-flex tw-justify-end"};function I(e,t,a,l,i,s){const n=(0,r.g2)("q-input"),d=(0,r.g2)("q-select"),u=(0,r.g2)("q-btn"),c=(0,r.g2)("q-date"),m=(0,r.g2)("q-popup-proxy"),b=(0,r.g2)("q-icon"),p=(0,r.g2)("q-checkbox"),f=(0,r.g2)("q-form"),g=(0,r.gN)("close-popup");return(0,r.uX)(),(0,r.Wv)(f,{onSubmit:(0,o.D$)(e.submit,["prevent"])},{default:(0,r.k6)((()=>[(0,r.bF)(n,{dark:"",filled:"",error:""!=e.form.errors.client,"error-message":e.form.errors.client,disable:e.loading,type:"text",modelValue:e.form.client,"onUpdate:modelValue":t[0]||(t[0]=t=>e.form.client=t),label:"Nombre del cliente"},null,8,["error","error-message","disable","modelValue"]),(0,r.bF)(n,{dark:"",filled:"",error:""!=e.form.errors.phone,"error-message":e.form.errors.phone,disable:e.loading,type:"text",modelValue:e.form.phone,"onUpdate:modelValue":t[1]||(t[1]=t=>e.form.phone=t),label:"Telefono del cliente"},null,8,["error","error-message","disable","modelValue"]),(0,r.bF)(n,{dark:"",filled:"",error:""!=e.form.errors.description,"error-message":e.form.errors.description,disable:e.loading,type:"textarea",modelValue:e.form.description,"onUpdate:modelValue":t[2]||(t[2]=t=>e.form.description=t),label:"Descripcion del trabajo"},null,8,["error","error-message","disable","modelValue"]),(0,r.bF)(n,{dark:"",filled:"",error:""!=e.form.errors.specs,"error-message":e.form.errors.specs,disable:e.loading,type:"textarea",modelValue:e.form.specs,"onUpdate:modelValue":t[3]||(t[3]=t=>e.form.specs=t),label:"Especificaciones del trabajo"},null,8,["error","error-message","disable","modelValue"]),(0,r.bF)(d,{dark:"",filled:"",error:""!=e.form.errors.status,"error-message":e.form.errors.status,disable:e.loading,modelValue:e.form.status,"onUpdate:modelValue":t[4]||(t[4]=t=>e.form.status=t),options:e.statuses,"option-value":"id","option-label":"name","emit-value":"","map-options":"",label:"Estado"},null,8,["error","error-message","disable","modelValue","options"]),(0,r.bF)(n,{dark:"",filled:"",error:""!=e.form.errors.agreed_delivery_date,"error-message":e.form.errors.agreed_delivery_date,disable:e.loading,modelValue:e.form.agreed_delivery_date,"onUpdate:modelValue":t[6]||(t[6]=t=>e.form.agreed_delivery_date=t),mask:"date"},{append:(0,r.k6)((()=>[(0,r.bF)(b,{name:"mdi-calendar",class:"tw-cursor-pointer"},{default:(0,r.k6)((()=>[(0,r.bF)(m,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,r.k6)((()=>[(0,r.bF)(c,{dark:"",modelValue:e.form.agreed_delivery_date,"onUpdate:modelValue":t[5]||(t[5]=t=>e.form.agreed_delivery_date=t)},{default:(0,r.k6)((()=>[(0,r.Lk)("div",V,[(0,r.bo)((0,r.bF)(u,{label:"Cerrar",color:"primary",flat:""},null,512),[[g]])])])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["error","error-message","disable","modelValue"]),(0,r.bF)(p,{dark:"",modelValue:e.form.paid,"onUpdate:modelValue":t[7]||(t[7]=t=>e.form.paid=t),label:"Pagado",color:"primary"},null,8,["modelValue"]),(0,r.Lk)("div",q,[(0,r.bF)(u,{type:"submit",loading:e.loading,label:"Guardar",unelevated:"",rounded:"","no-caps":""},null,8,["loading"])])])),_:1},8,["onSubmit"])}var T=a(4616),E=a(1764);const Q=async()=>{const e=(0,T.H9)(E.db,"counters","consecutive_counter"),t=await(0,T.x7)(e);t.exists()||await(0,T.BN)(e,{counter:0}),await(0,T.mZ)(e,{counter:(0,T.GV)(1)});const a=(await(0,T.x7)(e)).data()?.counter;return String(a??0).padStart(8,"0")},z=async e=>{await(0,T.gS)((0,T.rJ)(E.db,"jobs"),{...e,reference:await Q(),created_at:new Date,updated_at:new Date})},O=async(e,t)=>{const a=(0,T.H9)(E.db,"jobs",e);await(0,T.mZ)(a,{...t,updated_at:new Date})},U=async(e,t)=>{const a=(0,T.H9)(E.db,"jobs",e);await(0,T.gS)((0,T.rJ)(E.db,"job_notes"),{job_ref:a,comments:t,user:E.j.currentUser.email,created_at:new Date})},W=async(e,t)=>{const a=(0,T.H9)(E.db,"jobs",e);await(0,T.gS)((0,T.rJ)(E.db,"job_histories"),{job_ref:a,comments:t,user:E.j.currentUser.email,created_at:new Date})},J=async({statusFilter:e=[],requiresAttentionFilter:t=null,paidFilter:a=null,referenceFilter:r=null,lastDoc:l=null,pageSize:o=10})=>{let i=(0,T.P)((0,T.rJ)(E.db,"jobs"));e.length>0&&(i=(0,T.P)(i,(0,T._M)("status","in",e))),null!==t&&(i=(0,T.P)(i,(0,T._M)("requires_attention","==",t))),null!==a&&(i=(0,T.P)(i,(0,T._M)("paid","==",a))),r&&(i=(0,T.P)(i,(0,T._M)("reference","==",r))),i=(0,T.P)(i,(0,T.My)("agreed_delivery_date","asc")),l&&(i=(0,T.P)(i,(0,T.HM)(l))),i=(0,T.P)(i,(0,T.AB)(o));const s=await(0,T.GG)(i),n=s.docs.map((e=>({id:e.id,...e.data()}))),d=s.docs[s.docs.length-1]??null;return{jobs:n,lastVisible:d}},P=async e=>{const t=(0,T.rJ)(E.db,"job_histories"),a=(0,T.P)(t,(0,T._M)("job_ref","==",(0,T.H9)(E.db,"jobs",e))),r=await(0,T.GG)(a),l=r.docs.map((e=>({id:e.id,...e.data()})));return l},Y=async e=>{const t=(0,T.rJ)(E.db,"job_notes"),a=(0,T.P)(t,(0,T._M)("job_ref","==",(0,T.H9)(E.db,"jobs",e))),r=await(0,T.GG)(a),l=r.docs.map((e=>({id:e.id,...e.data()})));return l},K=async e=>{const t=(0,T.wP)(E.db),a=(0,T.P)((0,T.rJ)(E.db,"job_notes"),(0,T._M)("job_ref","==",(0,T.H9)(E.db,"jobs",e))),r=await(0,T.GG)(a);r.forEach((e=>{t.delete(e.ref)}));const l=(0,T.P)((0,T.rJ)(E.db,"job_histories"),(0,T._M)("job_ref","==",(0,T.H9)(E.db,"jobs",e))),o=await(0,T.GG)(l);o.forEach((e=>{t.delete(e.ref)}));const i=(0,T.H9)(E.db,"jobs",e);t.delete(i),await t.commit()};var R=a(3022);const X=(0,r.pM)({emits:["success"],setup(e,{emit:t}){const a=(0,S.KR)(!1),r=(0,R.A)(),l=()=>{const e=new Date,t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return`${t}/${a}/${r}`},o=[{id:"pending",name:"Pendiente/Nuevo"},{id:"process",name:"En Proceso"},{id:"canceled",name:"Cancelado"},{id:"damaged",name:"Con Daño"},{id:"finished",name:"Terminado"},{id:"delivered",name:"Entregado/Instalado"},{id:"returned",name:"Devuelto"}],i=(0,S.Kh)({client:"",phone:"",description:"",specs:"",status:"pending",agreed_delivery_date:l(),requires_attention:!1,paid:!1,errors:{client:"",phone:"",description:"",specs:"",status:"",agreed_delivery_date:""}}),s=()=>{let e=!0;return i.client?i.errors.client="":(i.errors.client="El nombre del cliente es requerido.",e=!1),i.phone?i.errors.phone="":(i.errors.phone="El teléfono es requerido.",e=!1),i.description?i.errors.description="":(i.errors.description="La descripción es requerida.",e=!1),i.specs?i.errors.specs="":(i.errors.specs="Las especificaciones son requeridas.",e=!1),i.status?i.errors.status="":(i.errors.status="El estado es requerido.",e=!1),i.agreed_delivery_date?i.errors.agreed_delivery_date="":(i.errors.agreed_delivery_date="La fecha de entrega es requerida.",e=!1),e},n=async()=>{try{if(s()){a.value=!0;const e={client:i.client,phone:i.phone,description:i.description,specs:i.specs,status:i.status,agreed_delivery_date:new Date(i.agreed_delivery_date),requires_attention:i.requires_attention,paid:i.paid};await z(e),i.client="",i.phone="",i.description="",i.specs="",i.status="pending",i.agreed_delivery_date=l(),i.requires_attention=!1,i.paid=!1,t("success")}}catch{console.error("Error"),r.notify({message:"Ocurrio un error al guardar."})}finally{a.value=!1}};return{form:i,submit:n,statuses:o,loading:a}}});var H=a(2968),$=a(3417),B=a(6067),G=a(4486),Z=a(3933),ee=a(8360),te=a(3713),ae=a(9039),re=a(8349),le=a(1038),oe=a(272),ie=a.n(oe);const se=(0,H.A)(X,[["render",I]]),ne=se;ie()(X,"components",{QForm:$.A,QInput:B.A,QSelect:G.A,QIcon:Z.A,QPopupProxy:ee.A,QDate:te.A,QBtn:ae.A,QCheckbox:re.A}),ie()(X,"directives",{ClosePopup:le.A});const de={class:"tw-flex tw-items-center tw-justify-center"},ue={class:"tw-flex tw-justify-end"};function ce(e,t,a,l,i,s){const n=(0,r.g2)("q-input"),d=(0,r.g2)("q-select"),u=(0,r.g2)("q-btn"),c=(0,r.g2)("q-date"),m=(0,r.g2)("q-popup-proxy"),b=(0,r.g2)("q-icon"),p=(0,r.g2)("q-checkbox"),f=(0,r.g2)("q-form"),g=(0,r.gN)("close-popup");return(0,r.uX)(),(0,r.Wv)(f,{onSubmit:(0,o.D$)(e.submit,["prevent"])},{default:(0,r.k6)((()=>[(0,r.bF)(n,{dark:"",filled:"",error:""!=e.form.errors.client,"error-message":e.form.errors.client,disable:e.loading,type:"text",modelValue:e.form.client,"onUpdate:modelValue":t[0]||(t[0]=t=>e.form.client=t),label:"Nombre del cliente"},null,8,["error","error-message","disable","modelValue"]),(0,r.bF)(n,{dark:"",filled:"",error:""!=e.form.errors.phone,"error-message":e.form.errors.phone,disable:e.loading,type:"text",modelValue:e.form.phone,"onUpdate:modelValue":t[1]||(t[1]=t=>e.form.phone=t),label:"Telefono del cliente"},null,8,["error","error-message","disable","modelValue"]),(0,r.bF)(n,{dark:"",filled:"",error:""!=e.form.errors.description,"error-message":e.form.errors.description,disable:e.loading,type:"textarea",modelValue:e.form.description,"onUpdate:modelValue":t[2]||(t[2]=t=>e.form.description=t),label:"Descripcion del trabajo"},null,8,["error","error-message","disable","modelValue"]),(0,r.bF)(n,{dark:"",filled:"",error:""!=e.form.errors.specs,"error-message":e.form.errors.specs,disable:e.loading,type:"textarea",modelValue:e.form.specs,"onUpdate:modelValue":t[3]||(t[3]=t=>e.form.specs=t),label:"Especificaciones del trabajo"},null,8,["error","error-message","disable","modelValue"]),(0,r.bF)(d,{dark:"",filled:"",error:""!=e.form.errors.status,"error-message":e.form.errors.status,disable:e.loading,modelValue:e.form.status,"onUpdate:modelValue":t[4]||(t[4]=t=>e.form.status=t),options:e.statuses,"option-value":"id","option-label":"name","emit-value":"","map-options":"",label:"Estado"},null,8,["error","error-message","disable","modelValue","options"]),(0,r.bF)(n,{dark:"",filled:"",error:""!=e.form.errors.agreed_delivery_date,"error-message":e.form.errors.agreed_delivery_date,disable:e.loading,modelValue:e.form.agreed_delivery_date,"onUpdate:modelValue":t[6]||(t[6]=t=>e.form.agreed_delivery_date=t),mask:"date"},{append:(0,r.k6)((()=>[(0,r.bF)(b,{name:"mdi-calendar",class:"tw-cursor-pointer"},{default:(0,r.k6)((()=>[(0,r.bF)(m,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,r.k6)((()=>[(0,r.bF)(c,{dark:"",modelValue:e.form.agreed_delivery_date,"onUpdate:modelValue":t[5]||(t[5]=t=>e.form.agreed_delivery_date=t)},{default:(0,r.k6)((()=>[(0,r.Lk)("div",de,[(0,r.bo)((0,r.bF)(u,{label:"Cerrar",color:"primary",flat:""},null,512),[[g]])])])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["error","error-message","disable","modelValue"]),(0,r.bF)(p,{dark:"",modelValue:e.form.requires_attention,"onUpdate:modelValue":t[7]||(t[7]=t=>e.form.requires_attention=t),label:"Requiere Atención",color:"primary"},null,8,["modelValue"]),(0,r.bF)(p,{dark:"",modelValue:e.form.paid,"onUpdate:modelValue":t[8]||(t[8]=t=>e.form.paid=t),label:"Pagado",color:"primary"},null,8,["modelValue"]),(0,r.Lk)("div",ue,[(0,r.bF)(u,{type:"submit",loading:e.loading,label:"Guardar",unelevated:"",rounded:"","no-caps":""},null,8,["loading"])])])),_:1},8,["onSubmit"])}const me=(0,r.pM)({emits:["success"],props:{job:{type:Object,required:!0}},setup(e,{emit:t}){const a=(0,S.KR)(!1),r=(0,R.A)(),l=e=>{const t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return`${t}/${a}/${r}`},o=[{id:"pending",name:"Pendiente/Nuevo"},{id:"process",name:"En Proceso"},{id:"canceled",name:"Cancelado"},{id:"damaged",name:"Con Daño"},{id:"finished",name:"Terminado"},{id:"delivered",name:"Entregado/Instalado"},{id:"returned",name:"Devuelto"}],i=(0,S.Kh)({client:e.job.client,phone:e.job.phone,description:e.job.description,specs:e.job.specs,status:e.job.status,agreed_delivery_date:l(e.job.agreed_delivery_date.toDate()),requires_attention:e.job.requires_attention,paid:e.job.paid,errors:{client:"",phone:"",description:"",specs:"",status:"",agreed_delivery_date:""}}),s=()=>{let e=!0;return i.client?i.errors.client="":(i.errors.client="El nombre del cliente es requerido.",e=!1),i.phone?i.errors.phone="":(i.errors.phone="El teléfono es requerido.",e=!1),i.description?i.errors.description="":(i.errors.description="La descripción es requerida.",e=!1),i.specs?i.errors.specs="":(i.errors.specs="Las especificaciones son requeridas.",e=!1),i.status?i.errors.status="":(i.errors.status="El estado es requerido.",e=!1),i.agreed_delivery_date?i.errors.agreed_delivery_date="":(i.errors.agreed_delivery_date="La fecha de entrega es requerida.",e=!1),e},n=async()=>{try{if(s()){a.value=!0;const r={client:i.client,phone:i.phone,description:i.description,specs:i.specs,status:i.status,agreed_delivery_date:new Date(i.agreed_delivery_date),requires_attention:i.requires_attention,paid:i.paid};await O(e.job.id,r),await W(e.job.id,"Modificación de los datos trabajo."),t("success",{...r,agreed_delivery_date:T.Dc.fromDate(r.agreed_delivery_date)})}}catch{r.notify({message:"Ocurrio un error al guardar."})}finally{a.value=!1}};return{form:i,submit:n,statuses:o,loading:a}}}),be=(0,H.A)(me,[["render",ce]]),pe=be;function fe(e,t,a,o,i,s){const n=(0,r.g2)("q-item-label"),d=(0,r.g2)("q-item-section"),u=(0,r.g2)("q-item"),c=(0,r.g2)("q-list");return(0,r.uX)(),(0,r.Wv)(c,{separator:"",dark:""},{default:(0,r.k6)((()=>[e.histories.length>0?((0,r.uX)(!0),(0,r.CE)(r.FK,{key:0},(0,r.pI)(e.histories,(t=>((0,r.uX)(),(0,r.Wv)(u,{key:t.id},{default:(0,r.k6)((()=>[(0,r.bF)(d,null,{default:(0,r.k6)((()=>[(0,r.bF)(n,{overline:""},{default:(0,r.k6)((()=>[(0,r.eW)((0,l.v_)(e.formatDateDateTimeString(t.created_at.toDate())),1)])),_:2},1024),(0,r.bF)(n,null,{default:(0,r.k6)((()=>[(0,r.eW)((0,l.v_)(t.user),1)])),_:2},1024),(0,r.bF)(n,{caption:"",lines:"2"},{default:(0,r.k6)((()=>[(0,r.eW)((0,l.v_)(t.comments),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128)):((0,r.uX)(),(0,r.Wv)(u,{key:1},{default:(0,r.k6)((()=>[(0,r.bF)(n,null,{default:(0,r.k6)((()=>t[0]||(t[0]=[(0,r.eW)("Sin entradas")]))),_:1})])),_:1}))])),_:1})}ie()(me,"components",{QForm:$.A,QInput:B.A,QSelect:G.A,QIcon:Z.A,QPopupProxy:ee.A,QDate:te.A,QBtn:ae.A,QCheckbox:re.A}),ie()(me,"directives",{ClosePopup:le.A});const ge=e=>{const t=new Date,a=e.getTime()-t.getTime(),r=a/864e5,l=Math.min(Math.max(r,0),15),o=Math.floor(255*(1-l/15)),i=Math.floor(l/15*255);return`#${o.toString(16).padStart(2,"0")}${i.toString(16).padStart(2,"0")}00`},ke=e=>{const t=String(e.getDate()).padStart(2,"0"),a=String(e.getMonth()+1).padStart(2,"0"),r=e.getFullYear(),l=String(e.getHours()).padStart(2,"0"),o=String(e.getMinutes()).padStart(2,"0"),i=String(e.getSeconds()).padStart(2,"0");return`${t}/${a}/${r} ${l}:${o}:${i}`},we=e=>{const t=String(e.getDate()).padStart(2,"0"),a=String(e.getMonth()+1).padStart(2,"0"),r=e.getFullYear();return`${t}/${a}/${r}`},ye=(0,r.pM)({props:{job:{type:Object,required:!0}},setup(e){const t=(0,S.KR)([]);return(0,r.KC)((async()=>{t.value=await P(e.job.id)})),{histories:t,formatDateDateTimeString:ke}}});var _e=a(3766),ve=a(2589),je=a(4958),Fe=a(1420);const Me=(0,H.A)(ye,[["render",fe]]),xe=Me;function Le(e,t,a,o,i,s){const n=(0,r.g2)("q-item-label"),d=(0,r.g2)("q-item-section"),u=(0,r.g2)("q-item"),c=(0,r.g2)("q-btn"),m=(0,r.g2)("q-list");return(0,r.uX)(),(0,r.Wv)(m,{separator:"",dark:""},{default:(0,r.k6)((()=>[(0,r.bF)(u,null,{default:(0,r.k6)((()=>[(0,r.bF)(d,null,{default:(0,r.k6)((()=>[(0,r.bF)(n,{overline:""},{default:(0,r.k6)((()=>t[0]||(t[0]=[(0,r.eW)("Cliente")]))),_:1}),(0,r.bF)(n,{class:"tw-capitalize"},{default:(0,r.k6)((()=>[(0,r.eW)((0,l.v_)(e.job.client),1)])),_:1})])),_:1})])),_:1}),(0,r.bF)(u,null,{default:(0,r.k6)((()=>[(0,r.bF)(d,null,{default:(0,r.k6)((()=>[(0,r.bF)(n,{overline:""},{default:(0,r.k6)((()=>t[1]||(t[1]=[(0,r.eW)("Telefono")]))),_:1}),(0,r.bF)(n,null,{default:(0,r.k6)((()=>[(0,r.eW)((0,l.v_)(e.job.phone),1)])),_:1})])),_:1}),(0,r.bF)(d,{side:""},{default:(0,r.k6)((()=>[(0,r.bF)(c,{color:"green",icon:"mdi-phone",round:"",unelevated:"",href:`tel:${e.job.phone}`},null,8,["href"])])),_:1})])),_:1}),(0,r.bF)(u,null,{default:(0,r.k6)((()=>[(0,r.bF)(d,null,{default:(0,r.k6)((()=>[(0,r.bF)(n,{overline:""},{default:(0,r.k6)((()=>t[2]||(t[2]=[(0,r.eW)("Descripcion")]))),_:1}),(0,r.bF)(n,null,{default:(0,r.k6)((()=>[(0,r.eW)((0,l.v_)(e.job.description),1)])),_:1})])),_:1})])),_:1}),(0,r.bF)(u,null,{default:(0,r.k6)((()=>[(0,r.bF)(d,null,{default:(0,r.k6)((()=>[(0,r.bF)(n,{overline:""},{default:(0,r.k6)((()=>t[3]||(t[3]=[(0,r.eW)("Especificaciones")]))),_:1}),(0,r.bF)(n,null,{default:(0,r.k6)((()=>[(0,r.eW)((0,l.v_)(e.job.specs),1)])),_:1})])),_:1})])),_:1}),(0,r.bF)(u,null,{default:(0,r.k6)((()=>[(0,r.bF)(d,null,{default:(0,r.k6)((()=>[(0,r.bF)(n,{overline:""},{default:(0,r.k6)((()=>t[4]||(t[4]=[(0,r.eW)("Requiere Atención")]))),_:1}),(0,r.bF)(n,{class:"tw-bg-slate-300 tw-text-black tw-p-1 tw-rounded-lg tw-text-center tw-font-extrabold"},{default:(0,r.k6)((()=>[(0,r.eW)((0,l.v_)(e.job.requires_attention?"SI":"NO"),1)])),_:1})])),_:1}),(0,r.bF)(d,null,{default:(0,r.k6)((()=>[(0,r.bF)(n,{overline:""},{default:(0,r.k6)((()=>t[5]||(t[5]=[(0,r.eW)("Pagado")]))),_:1}),(0,r.bF)(n,{class:"tw-bg-slate-300 tw-text-black tw-p-1 tw-rounded-lg tw-text-center tw-font-extrabold"},{default:(0,r.k6)((()=>[(0,r.eW)((0,l.v_)(e.job.paid?"SI":"NO"),1)])),_:1})])),_:1})])),_:1}),(0,r.bF)(u,null,{default:(0,r.k6)((()=>[(0,r.bF)(d,null,{default:(0,r.k6)((()=>[(0,r.bF)(n,{overline:""},{default:(0,r.k6)((()=>t[6]||(t[6]=[(0,r.eW)("Fecha de creación")]))),_:1}),(0,r.bF)(n,null,{default:(0,r.k6)((()=>[(0,r.eW)((0,l.v_)(e.formatDateDateTimeString(e.job.created_at.toDate())),1)])),_:1})])),_:1})])),_:1})])),_:1})}ie()(ye,"components",{QList:_e.A,QItem:ve.A,QItemSection:je.A,QItemLabel:Fe.A});const De=(0,r.pM)({props:{job:{type:Object,required:!0}},setup(e){const t=(0,S.KR)([]);return(0,r.KC)((async()=>{t.value=await P(e.job.id)})),{histories:t,formatDateDateTimeString:ke,formatDateDateString:we,getColorBasedOnDate:ge}}}),he=(0,H.A)(De,[["render",Le]]),Ce=he;function Ae(e,t,a,l,o,i){const s=(0,r.g2)("q-chat-message");return(0,r.uX)(),(0,r.CE)("div",null,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.notes,(t=>((0,r.uX)(),(0,r.Wv)(s,{key:t.id,name:t.user,text:[t.comments],sent:t.user==e.email,stamp:e.formatDateDateTimeString(t.created_at.toDate())},null,8,["name","text","sent","stamp"])))),128))])}ie()(De,"components",{QList:_e.A,QItem:ve.A,QItemSection:je.A,QItemLabel:Fe.A,QBtn:ae.A});var Ne=a(42);const Se=(0,r.pM)({props:{job:{type:Object,required:!0}},setup(e){const t=(0,S.KR)([]),a=async()=>{t.value=await Y(e.job.id)};return Ne.bus.on("newComment",a),(0,r.KC)(a),{notes:t,formatDateDateTimeString:ke,email:E.j.currentUser.email}}});var Ve=a(1022);const qe=(0,H.A)(Se,[["render",Ae]]),Ie=qe;ie()(Se,"components",{QChatMessage:Ve.A});const Te={class:"tw-flex tw-justify-end"};function Ee(e,t,a,l,i,s){const n=(0,r.g2)("q-input"),d=(0,r.g2)("q-btn"),u=(0,r.g2)("q-form");return(0,r.uX)(),(0,r.Wv)(u,{onSubmit:(0,o.D$)(e.submit,["prevent"]),class:"tw-flex tw-items-center tw-space-x-3"},{default:(0,r.k6)((()=>[(0,r.bF)(n,{class:"tw-grow",autogrow:"",dark:"",filled:"",error:""!=e.form.errors.comment,"error-message":e.form.errors.comment,disable:e.loading,type:"textarea",modelValue:e.form.comment,"onUpdate:modelValue":t[0]||(t[0]=t=>e.form.comment=t),label:"Comentar"},null,8,["error","error-message","disable","modelValue"]),(0,r.Lk)("div",Te,[(0,r.bF)(d,{type:"submit",loading:e.loading,color:"primary",label:"Enviar",unelevated:"",rounded:"","no-caps":""},null,8,["loading"])])])),_:1},8,["onSubmit"])}const Qe=(0,r.pM)({emits:["success"],props:{job:{type:Object,required:!0}},setup(e){const t=(0,S.KR)(!1),a=(0,R.A)(),r=(0,S.Kh)({comment:"",errors:{comment:""}}),l=()=>{let e=!0;return r.comment?r.errors.comment="":(r.errors.comment="El comentario es requerido.",e=!1),e},o=async()=>{try{l()&&(t.value=!0,await U(e.job.id,r.comment),Ne.bus.emit("newComment"))}catch{a.notify({message:"Error"})}finally{r.comment="",t.value=!1}};return{form:r,submit:o,loading:t}}}),ze=(0,H.A)(Qe,[["render",Ee]]),Oe=ze;ie()(Qe,"components",{QForm:$.A,QInput:B.A,QBtn:ae.A});var Ue=a(455),We=a(7003);const Je=(0,r.pM)({components:{AddJobForm:ne,UpdateJobForm:pe,JobHistory:xe,JobDetail:Ce,FormComment:Oe,JobNotes:Ie},setup(){const e=(0,Ue.rd)(),t=(0,R.A)(),a=(0,S.KR)(!1),r=(0,S.KR)(!1),l=(0,S.KR)(!1),o=(0,S.KR)(!1),i=(0,S.KR)(null),s=(0,S.KR)(null),n=(0,S.KR)(["pending","process","damaged"]),d=(0,S.KR)(null),u=(0,S.KR)(null),c=(0,S.Kh)({index:0,job:null}),m=(e,t)=>{c.index=e,c.job=t,r.value=!0},b=(e,a)=>{t.dialog({dark:!0,title:"Confirmar",message:a.requires_attention?"Quiere quitar la marca de atención?":"Quiere poner la marca de atención?",cancel:{label:"Cancelar",flat:!0,color:"primary"},ok:{label:"Si",flat:!0,color:"primary"},persistent:!0}).onOk((()=>{try{const t=!f.value[e].requires_attention;f.value[e].requires_attention=t,O(a.id,{requires_attention:t}),W(a.id,t?"Se marco que requiere atención":"Se quito la marca de atención")}catch{t.notify({message:"Ocurrio un error"})}}))},p=(e,a)=>{t.dialog({dark:!0,title:"Confirmar",message:a.paid?"Quiere quitar la marca de pagado?":"Quiere poner la marca de pagado?",cancel:{label:"Cancelar",flat:!0,color:"primary"},ok:{label:"Si",flat:!0,color:"primary"},persistent:!0}).onOk((()=>{try{const t=!f.value[e].paid;f.value[e].paid=t,O(a.id,{paid:t}),W(a.id,t?"Se marco como pagado":"Se quito la marca de pagado")}catch{t.notify({message:"Ocurrio un error"})}}))},f=(0,S.KR)([]),g=(0,S.KR)(!1),k=(0,S.KR)(null),w=async(e,t)=>{try{if(g.value)return;g.value=!0;const{jobs:e,lastVisible:a}=await J({statusFilter:n.value,requiresAttentionFilter:d.value,paidFilter:u.value,referenceFilter:s.value,lastDoc:k.value,pageSize:10});f.value=[...f.value,...e],k.value=a,g.value=!1,t(null==k.value)}catch(e){console.error(e.message)}},y=()=>{f.value=[],k.value=null,i.value&&(i.value.reset(),i.value.resume(),i.value.trigger())},_=()=>{a.value=!1,y()},v=e=>{f.value[c.index]={...f.value[c.index],...e},r.value=!1},j={pending:"Pendiente/Nuevo",process:"En Proceso",canceled:"Cancelado",damaged:"Con Daño",finished:"Terminado",delivered:"Entregado/Instalado",returned:"Devuelto"},F=async()=>{await(0,We.y)(),await e.push({path:"/"})},M=(e,t)=>{c.index=e,c.job=t,l.value=!0},x=(e,a)=>{t.dialog({dark:!0,title:"Confirmar",message:"Se eliminará el trabajo y esta accion no es reversible, desea continuar?",cancel:{label:"Cancelar",flat:!0,color:"primary"},ok:{label:"Continuar",flat:!0,color:"primary"},persistent:!0}).onOk((()=>{(async()=>{try{await K(a.id),y()}catch{t.notify({message:"Ocurrio un error"})}})()}))},L=(e,t)=>{c.index=e,c.job=t,o.value=!0},D=(e,a)=>{t.dialog({dark:!0,title:"Opciones",message:"Cambie el estado del trabajo:",options:{type:"radio",model:a.status,items:Object.keys(j).map((e=>({value:e,label:j[e],color:"primary"})))},cancel:{label:"Cancelar",flat:!0,color:"primary"},ok:{label:"Aplicar",flat:!0,color:"primary"},persistent:!0}).onOk((r=>{try{f.value[e].status=r,O(a.id,{status:r}),W(a.id,`Cambio el estado del trabajo a ${j[r]}`)}catch{t.notify({message:"Ocurrio un error"})}}))};return{showHistory:M,close:F,restart:y,statusFilter:n,updateJob:m,requiresAttentionFilter:d,requiresAttention:b,paid:p,paidFilter:u,loading:g,reference:s,getColorBasedOnDate:ge,formatDateDateString:we,infinite:i,create:a,update:r,history:l,show:o,jobs:f,loadJobs:w,onCreated:_,onUpdated:v,deleteJobConfirm:x,formatDateDateTimeString:ke,showJob:L,selectedJob:c,statuses:j,changeStatus:D}}});var Pe=a(5013),Ye=a(8330),Ke=a(4742),Re=a(3079),Xe=a(6835),He=a(2540),$e=a(3341),Be=a(222),Ge=a(5034),Ze=a(4028);const et=(0,H.A)(Je,[["render",N]]),tt=et;ie()(Je,"components",{QPage:Pe.A,QBtn:ae.A,QMenu:Ye.A,QCheckbox:re.A,QInput:B.A,QIcon:Z.A,QInfiniteScroll:Ke.A,QList:_e.A,QItem:ve.A,QItemSection:je.A,QSpinnerDots:Re.A,QPageSticky:Xe.A,QDialog:He.A,QCard:$e.A,QCardSection:Be.A,QCardActions:Ge.A}),ie()(Je,"directives",{ClosePopup:le.A,Ripple:Ze.A})},1930:e=>{e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwLjgyOSIgaGVpZ2h0PSIxOTEiIHZpZXdCb3g9IjAgMCA1My4xMzYgNTAuNTM1IiB4bWw6c3BhY2U9InByZXNlcnZlIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIHN0eWxlPSJmaWxsOiNmZmYiIGQ9Ik04NS4xMDQgMTI4Ljc1N2MtNi45NzgtNS4xMDgtMTIuNzg2LTkuMzgtMTIuOTA2LTkuNDkyLS4xMi0uMTEyLS4wMzMtLjg0My4xOTQtMS42MjUuMzU1LTEuMjIuNzIzLTEuNzE0IDIuNi0zLjQ4M2wyLjE4Ny0yLjA2LTEuMzkuMDc2Yy0uNzYzLjA0Mi0xLjM4OC0uMDE3LTEuMzg4LS4xMzIgMC0uMTg0IDMuNDI1LTEwLjY5IDYuODEtMjAuODkybDEuMjA4LTMuNjM4aDE1LjUzdjI1LjI2N2MwIDEzLjg5Ny0uMDM2IDI1LjI2OC0uMDc5IDI1LjI2OC0uMDQzIDAtNS43ODgtNC4xOC0xMi43NjYtOS4yODl6bTcuMDI0LTEwLjAyNnYtNi42MTRoLTUuMzIxbC0yLjk2MiAyLjU2Yy0xLjYzIDEuNDA4LTIuOTYyIDIuNjctMi45NjIgMi44MDMgMCAuMyAxMC40NTUgNy44MTQgMTAuOTE0IDcuODQ0LjI1Ni4wMTcuMzMtMS40NjYuMzMtNi41OTN6bS0uMDYxLTE4Ljg2LjA3LTYuMDMtMi41NjcuMDc2LTIuNTY3LjA3Ni0yLjAzMyA1LjgyYy0xLjExOCAzLjIwMi0xLjk4IDUuOTE0LTEuOTE2IDYuMDI2LjA2NC4xMTMgMi4xMDMuMTcyIDQuNTMuMTMzbDQuNDEyLS4wNzN6bTcuMjA1IDE5Ljk3N2MwLTkuODguMDc4LTIxLjE5OC4xNzQtMjUuMTVsLjE3NS03LjE4N2gxNS45NWwyLjQzNCA3LjczOWE2NDI5LjQxNCA2NDI5LjQxNCAwIDAgMCA0Ljk1MiAxNS42NThjMS4zODUgNC4zNTYgMi40MjYgOCAyLjMxNSA4LjA5Ny0uNDczLjQxMi0yNS4xMDEgMTguMjY2LTI1LjY3IDE4LjYwOC0uMjYzLjE1OS0uMzMtMy40NjMtLjMzLTE3Ljc2NXptOC40NjYgNC4yMjNjLjk0Ni0uNjk5IDMuNjU1LTIuNjczIDYuMDItNC4zODcgMi4zNjQtMS43MTQgNC4yOTktMy4xNTggNC4yOTktMy4yMSAwLS4wNTEtMS41MDItNC44MzMtMy4zMzgtMTAuNjI2LTEuODM2LTUuNzkzLTMuNDIyLTEwLjgzLTMuNTI0LTExLjE5NC0uMTgxLS42NDMtLjI2LS42NjMtMi44OC0uNzM3bC0yLjY5My0uMDc1djE1Ljc1MmMwIDguNjY0LjA4OSAxNS43NS4xOTggMTUuNzUuMTEtLjAwMi45NzItLjU3NSAxLjkxOC0xLjI3M3oiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC03Mi4xNDQgLTg3LjUxKSIvPjwvc3ZnPg=="}}]);